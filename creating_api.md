# 新建API

为了将自己的API发布在EnOS上，以供授权的使用者调用，用户需要首先在API管理种定义自己的API。

## 任务描述

本文介绍了如何在API管理中创建API。

## 开始前准备

- 拥有一个EnOS账号，并拥有定义API操作需要的相应权限，参考[策略，角色，与权限](/docs/iam/zh_CN/latest/access_policy)。
- 了解API管理相关[概念](api_management_concepts)。

## 新建API组

1. 选择 **API管理 > 我的API**；

2. 点击**新建API组**，填入以下字段：
   
   - 分组名称：支持英文大小写、数字、连字符(-)，不超过32个字符；
   - 分组路径
   - 分组描述：不超过140个字符

3. 点击**保存**，完成API组的创建；

   .. image:: media/creating_api_group.png

## 新建API

1. 点击已创建的API组，在API组详情页，点击**添加API**；
   
2. 在API基本信息页，填入下列字段后点击**下一步**：
   - API名称
   - API类型：支持私有或三方类型。
   - API描述

3. 在API后端服务页，填入下列字段后点击**下一步**：
   - 后端服务地址：即实际提供该API服务的HTTP地址及端口号
   - HTTP Method：目前EnOS支持GET、POST、PUT、DELETE四种method
   - 后端请求路径：即提供该API服务的资源所在路径
   - 入参请求模式：API网关对入参的处理模式，支持透传和映射
      - 映射：即 API 网关在接收到API使用者的 API 请求时，通过映射关系将请求转换成后端需要的格式。
      - 透传：API 网关在接收到 API 请求后，不对请求进行处理，直接转发到后端服务。
   - 后端超时时间：指 API 请求到达 API 网关后，API 网关调用 API 后端服务的响应时间，即由 API 网关请求后端服务开始直至 API 网关收到后端返回结果的时长。单位为毫秒。如果响应时间超过该值，API 网关会放弃请求后端服务，并给用户返回相应的错误信息。
   - 后端参数：即调用后端服务所需要的参数。包含以下字段：
      - 参数名
      - 参数位置：参数在请求中的位置，可选Head、Query和Path
      - 数据类型：字段的类型，支持String、Int、Long、Float、Double、Boolean、Binary、Date、DateTime、Password。
      - 是否必选
      - 默认值
      - 描述
   - 常量参数：对API使用者不可见，但是 API 网关会在中转请求时，将这些参数加入到请求中的指定位置，再传递至后端服务，实现后端的业务需求。包含以下字段：
      - 参数名
      - 参数位置：常量参数在请求中的位置，支持Head和Query
      - 默认值
      - 描述
      - 操作

4. 在API请求页，填写下列字段后点击**下一步**：
   - API版本：用以标识API的不同版本，同一个API的不同版本可以挂载在同一个API组下面。 
   - 请求路径：API使用者为调用该API所使用的路径。如果入参请求模式为映射，请求路径可以根据需要由API开发者进行设定；如果入参请求模式为透传，请求路径需与后端请求路径保持一致。
   - API参数定义：当入参请求模式为映射时，需要设定API请求的参数定义。入参透传模式下，不需要定义参数。API参数定义包含下列字段：
      - 参数名：展示给API使用者的参数名称
      - 后端参数名：参数所映射的后端参数
      - 参数位置：参数在请求中的位置
      - 后端参数位置：对应的后端参数在API网关转发来的请求中的位置
      - 数据类型：字段的类型
      - 后端数据类型：对应的后端数据类型
      - 是否必填
      - 默认值
      - 描述

   上述字段中，参数名、是否必选、默认值、描述由用户自己设定，其他字段根据会自动匹配API后端服务页上后端参数的响应字段。

5. 在返回结果页，填写下列字段后点击**下一步**：
   - Content Type
   - 成功结果示例
   - 失败结果示例：可选字段。
   - 响应参数定义
   - 错误码定义

6. 在插件配置页，用户可以为将要发布在EnOS的API增加额外配置，当前EnOS支持下列功能：
   - 流控
   - 请求大小限制
   - IP限制
   - Mock测试

   点击**完成**

## 结果

在API组详情页，可以看到创建成功的API，当前该API的状态为**下线**，是否公开为**私有**。

## 后续操作

[部署API](deploying_api)